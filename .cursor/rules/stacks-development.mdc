---
description: Guidelines for Stacks blockchain development
---

# Stacks Development Guidelines

## Wallet Integration
- Use [@stacks/connect](https://github.com/stacks-network/connect) for wallet connections
- Always handle wallet connection states properly in [hooks/wallet.ts](mdc:hooks/wallet.ts)
- Implement proper error handling for wallet operations
- Use the `useWallet` hook for all wallet-related functionality

## Authentication
- JWT tokens are used for API authentication with wallet signatures
- API endpoints follow RESTful patterns in `app/api/auth/`
- Always verify signatures before creating sessions
- Use [lib/auth/jwt.ts](mdc:lib/auth/jwt.ts) for token operations

## Database
- Use Prisma with MongoDB for data persistence
- User model in [prisma/schema.prisma](mdc:prisma/schema.prisma) includes wallet address and connection history
- Always use database utilities in [lib/db/user.ts](mdc:lib/db/user.ts) for user operations

## API Development
- Follow the patterns established in `app/api/auth/` for new endpoints
- Use Zod for request validation
- Implement proper error handling with consistent response formats
- Always include TypeScript types for requests and responses

## Chainhooks Integration
- Use [Hiro Chainhooks](https://docs.hiro.so/stacks/chainhooks) for real-time blockchain event monitoring
- Server-side: Use [lib/chainhooks/client.ts](mdc:lib/chainhooks/client.ts) for all chainhook operations (create, list, get, update, delete, toggle, evaluate)
- Client-side: Use [hooks/chainhooks.ts](mdc:hooks/chainhooks.ts) React hook for managing chainhooks from components
- Webhook handler: Process events in [app/api/chainhooks/webhook/route.ts](mdc:app/api/chainhooks/webhook/route.ts)
  - Always verify webhook signatures using `SECRET_KEY` from environment variables
  - Handle both `apply` (new blocks) and `rollback` (chain reorganizations) events
  - Use types from [lib/types/chainhooks.ts](mdc:lib/types/chainhooks.ts) for type safety
- Configuration: Set `CHAINHOOKS_API_KEY`, `CHAINHOOKS_WEBHOOK_URL`, `CHAINHOOKS_NETWORK`, and `SECRET_KEY` in environment variables
- See [CHAINHOOKS.md](mdc:_docs/CHAINHOOKS.md) for detailed setup and usage examples